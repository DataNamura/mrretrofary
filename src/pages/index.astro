---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main>
		<div class="ditto-bg"></div>
		
		<div class="content-wrapper">
			<!-- Volume Control Inside Card -->
			<div class="volume-control" title="Toggle Music">
				<svg class="pixel-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
					<path d="M5 9v6h4l5 5V4L9 9H5zm18.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
				</svg>
			</div>

			<div class="profile-section">
				<div class="profile-frame">
					<img src="/mr retro.jpg" alt="Mr Retro Fary" class="profile-img" />
				</div>
				<h1 class="glitch-text" data-text="Mr Retro Fary">Mr Retro Fary</h1>
				<p class="subtitle">Retro Collector & Pixel Enthusiast</p>
			</div>

			<div class="about-section">
				<div class="pixel-window collapsed">
					<div class="window-bar">
						<span class="window-title">about_me.txt</span>
						<div class="window-controls">
							<span class="control min">_</span>
							<!-- Added class for targeting the arrow -->
							<span class="control max open-target">â–¡</span>
							<span class="control close">Ã—</span>
						</div>
					</div>
					<div class="window-content" style="display: none;">
						<p>Â¡Hola! Soy Mr Retro Fary. ðŸ‘‹</p>
						<p>Amante de lo retro, coleccionista de PokÃ©mon y fan absoluto de Ditto.</p>
						<p>AquÃ­ encontrarÃ¡s mis aventuras, hallazgos y directos. Â¡Bienvenido a mi mundo pixelado!</p>
					</div>
					<div class="click-hint">
						<span class="arrow">â¬‡</span> Click to Open
					</div>
				</div>
			</div>

			<div class="links-section">
				<a href="https://instagram.com/mrretrofary" target="_blank" class="retro-btn instagram">
					<svg class="pixel-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
					Instagram
				</a>
				<a href="https://es.wallapop.com/user/mrretrofary-placeholder" target="_blank" class="retro-btn wallapop">
					<svg class="pixel-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>
					Wallapop
				</a>
				<a href="https://twitch.tv/mrretrofary" target="_blank" class="retro-btn twitch">
					<svg class="pixel-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M2.149 0l-1.612 4.119v16.736h4.662v3.145h3.101l3.054-3.145h4.291l8.355-8.327v-12.528h-21.85zm19.16 11.181l-5.168 5.167h-4.291l-3.04 3.102v-3.102h-3.111v-12.722h15.61v7.555zm-10.436 4.414h2.367v-6.318h-2.367v6.318zm6.545 0h2.37v-6.318h-2.37v6.318z"/></svg>
					Twitch
				</a>
			</div>
			
			<div class="hidden-ditto" title="???">
				<div class="ditto-blob-mini"></div>
			</div>
		</div>
		
		<footer class="site-footer">
			Creado por <a href="https://namuratech.com" target="_blank">namuratech.com</a>
		</footer>

		<audio id="bg-music" loop>
			<source src="/Nostalgic Pokemon Music, but it's only generation 3 (Hoenn) [WViR2zZ-pfA].mp3" type="audio/mpeg">
			Your browser does not support the audio element.
		</audio>
	</main>
</Layout>

<script>
	// ... (Existing code for Hint, Avatar, Rain) ...

	// Hint click also opens
	const clickHint = document.querySelector('.click-hint');
	const windowContent = document.querySelector('.window-content') as HTMLElement;
	const pixelWindow = document.querySelector('.pixel-window');
	// ... Re-declaring for context if needed, but assuming global scope in Module works.
	// Actually, I need to update the EXISTING script block in the file, not append.
	// I will target the script block specifically in the next tool call if this one is just HTML.
	// Wait, I am replacing the HTML part here. I need to replace the JS part too.
</script>
<!-- Wait, replace_file_content replaces a BLOCK. I should do it in one go if they are close, or separate. -->
<!-- They are far apart (Script is at top, HTML at bottom). I will do HTML first, then JS. -->

<script>
	const minBtn = document.querySelector('.control.min') as HTMLElement;
	const maxBtn = document.querySelector('.control.max') as HTMLElement;
	const closeBtn = document.querySelector('.control.close') as HTMLElement;
	const windowContent = document.querySelector('.window-content') as HTMLElement;
	const windowElement = document.querySelector('.pixel-window') as HTMLElement;
	const clickHint = document.querySelector('.click-hint') as HTMLElement;

	function showContent() {
		if (windowContent) windowContent.style.display = 'block';
		if (clickHint) clickHint.style.display = 'none';
	}

	function hideContent() {
		if (windowContent) windowContent.style.display = 'none';
	}

	if (minBtn) {
		minBtn.addEventListener('click', hideContent);
	}

	if (maxBtn) {
		maxBtn.addEventListener('click', showContent);
	}

	if (closeBtn && windowElement) {
		closeBtn.addEventListener('click', () => {
			windowElement.style.display = 'none';
		});
	}

	// Hint click also opens
	if (clickHint) {
		clickHint.addEventListener('click', showContent);
	}

	// Ditto Transformation
	const profileImg = document.querySelector('.profile-img') as HTMLImageElement;
	const originalSrc = '/mr retro.jpg';
	const subtitle = document.querySelector('.subtitle') as HTMLElement;
	const originalSubtitle = subtitle.innerText;

	// The specific animated dancing Ditto
	const dancingDitto = '/ditto.gif';
	let isDitto = false;

	if (profileImg) {
		const toggleDitto = () => {
			if (!isDitto) {
				// Transform to Ditto
				profileImg.style.transform = 'scale(0.8) rotate(360deg)';
				profileImg.style.filter = 'hue-rotate(90deg) blur(2px)';
				
				setTimeout(() => {
					profileImg.src = dancingDitto;
					profileImg.style.transform = 'scale(1.1)';
					profileImg.style.filter = 'none';
					
					if (subtitle) {
						subtitle.innerText = "Â¡Has encontrado a RetroFarDitto!";
						subtitle.style.color = "#d6a2e8";
						subtitle.style.fontWeight = "bold";
						subtitle.style.textShadow = "1px 1px 0 #332b3b";
					}
				}, 200);
				isDitto = true;
			} else {
				// Revert to original
				profileImg.style.transform = 'scale(0.8)';
				profileImg.style.filter = 'blur(2px)';
				
				setTimeout(() => {
					profileImg.src = originalSrc;
					profileImg.style.transform = 'scale(1)';
					profileImg.style.filter = 'none';
					
					if (subtitle) {
						subtitle.innerText = originalSubtitle;
						subtitle.style.color = "";
						subtitle.style.fontWeight = "";
						subtitle.style.textShadow = "";
					}
				}, 200);
				isDitto = false;
			}
		};

		// Click to toggle
		profileImg.addEventListener('click', toggleDitto);
		profileImg.style.cursor = 'pointer';
	}

	// Hidden Ditto - Party Mode
	const hiddenDitto = document.querySelector('.hidden-ditto') as HTMLElement;
	let splitPartyMode = false;

	if (hiddenDitto) {
		hiddenDitto.addEventListener('click', () => {
			splitPartyMode = !splitPartyMode;
			if (splitPartyMode) {
				activatePartyMode();
			} else {
				deactivatePartyMode();
			}
		});
	}

	// Rain of Dittos Logic
	let rainInterval: number | undefined;

	function createRainDrop() {
		const drop = document.createElement('img');
		drop.src = '/ditto.gif';
		drop.classList.add('ditto-rain-drop');
		drop.style.left = Math.random() * 100 + 'vw';
		drop.style.animationDuration = Math.random() * 2 + 3 + 's'; // 3-5s fall
		drop.style.opacity = Math.random() * 0.5 + 0.5 + '';
		drop.style.width = Math.random() * 30 + 20 + 'px'; // Random size
		
		document.body.appendChild(drop);

		// Remove after animation
		setTimeout(() => {
			drop.remove();
		}, 5000);
	}

	function activatePartyMode() {
		// alert('âœ¨ Â¡LLUVIA DE DITTOS! âœ¨'); // Removed alert for smoother experience
		if (!rainInterval) {
			rainInterval = setInterval(createRainDrop, 300); // New ditto every 300ms
		}
	}

	function deactivatePartyMode() {
		if (rainInterval) {
			clearInterval(rainInterval);
			rainInterval = undefined;
		}
		// Remove existing drops
		document.querySelectorAll('.ditto-rain-drop').forEach(el => el.remove());
	}

	// Music Player Logic
	const volumeControl = document.querySelector('.volume-control') as HTMLElement;
	const bgMusic = document.getElementById('bg-music') as HTMLAudioElement;
	let isPlaying = false;

	if (volumeControl && bgMusic) {
		bgMusic.volume = 0.3; // Lower volume by default
		
		volumeControl.addEventListener('click', () => {
			if (isPlaying) {
				bgMusic.pause();
				volumeControl.classList.add('muted');
				volumeControl.style.opacity = '0.5';
			} else {
				bgMusic.play().catch(e => console.log("Audio play failed, user interaction needed first.", e));
				volumeControl.classList.remove('muted');
				volumeControl.style.opacity = '1';
			}
			isPlaying = !isPlaying;
		});
		
		// Set initial state
		volumeControl.style.opacity = '0.5';
	}
</script>

<style>
	/* Volume Control Styles */
	.volume-control {
		position: absolute;
		top: -20px;
		right: -20px;
		z-index: 1000;
		cursor: pointer;
		color: #fff;
		background: #ff9ff3; /* Pink pop color */
		padding: 12px;
		border-radius: 50%;
		border: 4px solid #332b3b;
		box-shadow: 4px 4px 0 #332b3b;
		transition: transform 0.2s, background 0.2s;
	}

	.volume-control:hover {
		transform: scale(1.1) rotate(5deg);
		background: #e056fd;
	}
	

	@keyframes rainbow {
		0% { filter: hue-rotate(0deg); }
		100% { filter: hue-rotate(360deg); }
	}

	html {
		cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><ellipse cx="16" cy="20" rx="14" ry="10" fill="%23d6a2e8" stroke="%23332b3b" stroke-width="2"/><ellipse cx="16" cy="20" rx="14" ry="10" fill="%23d6a2e8"/><circle cx="11" cy="18" r="2.5" fill="%23332b3b"/><circle cx="21" cy="18" r="2.5" fill="%23332b3b"/><ellipse cx="16" cy="22" rx="5" ry="2.5" fill="%23332b3b" opacity="0.2"/></svg>') 16 20, auto;
	}

	main {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		min-height: 100vh;
		padding: 2rem;
		position: relative;
		overflow: hidden;
	}

	.ditto-bg {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: -1;
		opacity: 0.15;
		background-image: 
			linear-gradient(#332b3b 1px, transparent 1px),
			linear-gradient(90deg, #332b3b 1px, transparent 1px);
		background-size: 30px 30px;
		animation: bgPan 20s linear infinite;
	}

	.content-wrapper {
		position: relative;
		background: rgba(255, 255, 255, 0.4);
		backdrop-filter: blur(8px);
		padding: 3rem;
		border-radius: 20px;
		border: 4px solid #332b3b;
		box-shadow: 
			8px 8px 0px #332b3b,
			inset 2px 2px 0px rgba(255, 255, 255, 0.5);
		text-align: center;
		max-width: 500px;
		width: 100%;
	}

	.avatar-container {
		width: 150px;
		height: 150px;
		margin: 0 auto 1.5rem;
		position: relative;
		animation: float 6s ease-in-out infinite;
	}

	.profile-img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		border-radius: 50%;
		border: 4px solid #332b3b;
		box-shadow: 6px 6px 0px rgba(51, 43, 59, 0.5);
	}

	@keyframes float {
		0%, 100% { transform: translateY(0); }
		50% { transform: translateY(-10px); }
	}

	h1 {
		font-size: 3rem;
		margin: 0;
		text-transform: uppercase;
		text-shadow: 2px 2px 0px #ff9ff3;
		letter-spacing: 2px;
	}

	.subtitle {
		font-size: 1.2rem;
		margin: 0.5rem 0 2rem;
		opacity: 0.8;
	}

	.about-section {
		margin-bottom: 2rem;
		width: 100%;
	}

	.pixel-window {
		background: #fff;
		border: 3px solid #332b3b;
		box-shadow: 6px 6px 0px rgba(51, 43, 59, 0.5);
		text-align: left;
		transition: all 0.2s;
		position: relative;
	}

	.window-bar {
		background: #332b3b;
		color: #fff;
		padding: 5px 10px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		font-family: inherit;
	}

	.window-title {
		font-size: 1rem;
		letter-spacing: 1px;
	}

	.window-controls {
		display: flex;
		gap: 8px;
	}

	.control {
		cursor: pointer;
		font-weight: bold;
	}
	
	.control:hover {
		color: #ff9ff3;
	}

	/* Hint Styles */
	.click-hint {
		position: absolute;
		top: -30px;
		right: 30px;
		background: #ff9ff3;
		color: #332b3b;
		padding: 2px 8px;
		border: 2px solid #332b3b;
		font-size: 0.8rem;
		animation: bounce 1s infinite;
		pointer-events: auto;
		cursor: pointer;
	}

	.click-hint::after {
		content: '';
		position: absolute;
		bottom: -6px;
		left: 50%;
		transform: translateX(-50%);
		border-left: 6px solid transparent;
		border-right: 6px solid transparent;
		border-top: 6px solid #332b3b;
	}

	@keyframes bounce {
		0%, 100% { transform: translateY(0); }
		50% { transform: translateY(-5px); }
	}

	@keyframes dance {
		0%, 100% { transform: scale(1.2) rotate(-10deg); }
		50% { transform: scale(1.2) rotate(10deg); }
	}

	.profile-img.dancing {
		animation: dance 0.4s infinite ease-in-out !important; /* Override float */
	}

	.window-content {
		padding: 1.5rem;
		font-size: 1.1rem;
		line-height: 1.4;
		color: #332b3b;
	}

	.window-content p {
		margin-bottom: 0.5rem;
	}

	.window-content p:last-child {
		margin-bottom: 0;
	}

	.links-section {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.retro-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 1rem;
		background: #fff;
		border: 3px solid #332b3b;
		color: #332b3b;
		text-decoration: none;
		font-size: 1.5rem;
		font-weight: bold;
		box-shadow: 4px 4px 0px #332b3b;
		transition: transform 0.1s, box-shadow 0.1s;
		position: relative;
		gap: 10px;
		cursor: pointer;
	}

	.retro-btn:hover {
		transform: translate(-2px, -2px);
		box-shadow: 6px 6px 0px #332b3b;
		background: #f0f0f0;
	}

	.retro-btn:active {
		transform: translate(2px, 2px);
		box-shadow: 2px 2px 0px #332b3b;
	}

	.hit-counter {
		margin-top: 2rem;
		font-family: 'VT323', monospace;
		font-size: 1.5rem;
		background: #000;
		color: #0f0;
		padding: 5px 10px;
		border: 2px solid #555;
		box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
		letter-spacing: 3px;
	}

	.pixel-icon {
		width: 24px;
		height: 24px;
	}

	.hidden-ditto {
		position: fixed;
		bottom: -15px;
		right: 20px;
		width: 60px;
		height: 50px;
		cursor: pointer;
		z-index: 100;
		transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
	}

	.hidden-ditto:hover {
		transform: translateY(-25px) scale(1.1);
	}

	.ditto-blob-mini {
		width: 100%;
		height: 100%;
		background: #d6a2e8;
		border: 3px solid #332b3b;
		border-radius: 50% 50% 40% 40%;
		position: relative;
		box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
	}

	.ditto-blob-mini::before,
	.ditto-blob-mini::after {
		content: '';
		position: absolute;
		top: 15px;
		width: 5px;
		height: 5px;
		background: #332b3b;
		border-radius: 50%;
	}

	.ditto-blob-mini::before { left: 18px; }
	.ditto-blob-mini::after { right: 18px; }

	/* Specific Button Colors */
	.instagram:hover { background: #ffe4e1; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px #332b3b; }
	.wallapop:hover { background: #e0f7fa; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px #332b3b; }
	.twitch:hover { background: #e3d7ff; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px #332b3b; }

	@keyframes morph {
		0% { border-radius: 46% 54% 27% 73% / 64% 45% 55% 36%; }
		50% { border-radius: 60% 40% 30% 70% / 50% 50% 50% 50%; }
		100% { border-radius: 46% 54% 27% 73% / 64% 45% 55% 36%; }
	}

	@keyframes bgPan {
		0% { background-position: 0 0; }
		100% { background-position: 30px 30px; }
	}
	
	@keyframes fall {
		0% { transform: translateY(-10vh) rotate(0deg); }
		100% { transform: translateY(110vh) rotate(360deg); }
	}

	:global(.ditto-rain-drop) {
		position: fixed;
		top: -10vh;
		z-index: 9999;
		pointer-events: none;
		animation-name: fall;
		animation-timing-function: linear;
		animation-fill-mode: forwards;
	}

	.site-footer {
		margin-top: 2rem;
		font-size: 1.2rem;
		color: #332b3b;
		opacity: 0.8;
		text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
	}

	.site-footer a {
		color: #332b3b;
		text-decoration: none;
		border-bottom: 2px solid transparent;
		transition: border-color 0.2s;
	}

	.site-footer a:hover {
		border-bottom-color: #332b3b;
	}
</style>
